<!DOCTYPE html>
<html>
    <head>
        <title><%= title %></title>
        <link rel="stylesheet" href="/css/styles.css">
        <meta name="viewport" content="width=device-width, initial-scale=1">
    </head>

    <body>
        <nav class="navbar">
            <span class="brand">
                <a href="/">SpinCycle Laundry</a>
            </span>
            <div class="auth">
                <a href="/">Home</a>
                <a href="/users/login">Login</a>
            </div>
        </nav>

        <div class="main-content">
            <h1>Create New Password</h1>
            <p style="text-align: center; color: #64748b; margin-bottom: 30px; max-width: 500px; margin-left: auto; margin-right: auto;">
                Enter your new password below. Make sure it's strong and secure.
            </p>
            
            <form action="/password/reset/<%= token %>" method="POST" id="resetForm">
                <label for="password">New Password</label>
                <input type="password" id="password" name="password" required placeholder="Enter your new password">

                <label for="confirm">Confirm New Password</label>
                <input type="password" id="confirm" name="confirm" required placeholder="Confirm your new password">

                <div id="password-match-indicator" style="display: none; text-align: center; margin: 16px 0; padding: 12px; border-radius: 8px;">
                    <span id="match-text"></span>
                </div>

                <button type="submit" id="submitBtn">Update Password</button>
                
                <div style="text-align: center; margin-top: 24px;">
                    <p>Remember your password? <a href="/users/login">Back to Login</a></p>
                </div>
            </form>
        </div>

        <footer>
            <p>&copy; 2025 SpinCycle Laundry. Making laundry effortless.</p>
        </footer>

        <script>
            const passwordInput = document.getElementById('password');
            const confirmInput = document.getElementById('confirm');
            const indicator = document.getElementById('password-match-indicator');
            const matchText = document.getElementById('match-text');
            const submitBtn = document.getElementById('submitBtn');
            const form = document.getElementById('resetForm');

            function checkPasswordMatch() {
                const password = passwordInput.value;
                const confirm = confirmInput.value;
                
                if (confirm.length === 0) {
                    indicator.style.display = 'none';
                    submitBtn.disabled = true;
                    return;
                }
                
                indicator.style.display = 'block';
                
                if (password === confirm && password.length >= 8) {
                    indicator.style.background = 'rgba(72, 187, 120, 0.1)';
                    indicator.style.border = '1px solid rgba(72, 187, 120, 0.2)';
                    matchText.style.color = '#38a169';
                    matchText.textContent = '✓ Passwords match!';
                    submitBtn.disabled = false;
                } else if (password === confirm) {
                    indicator.style.background = 'rgba(245, 166, 35, 0.1)';
                    indicator.style.border = '1px solid rgba(245, 166, 35, 0.2)';
                    matchText.style.color = '#d69e2e';
                    matchText.textContent = '⚠ Passwords match but should be at least 8 characters';
                    submitBtn.disabled = true;
                } else {
                    indicator.style.background = 'rgba(245, 101, 101, 0.1)';
                    indicator.style.border = '1px solid rgba(245, 101, 101, 0.2)';
                    matchText.style.color = '#e53e3e';
                    matchText.textContent = '✗ Passwords do not match';
                    submitBtn.disabled = true;
                }

                // Update button appearance
                if (submitBtn.disabled) {
                    submitBtn.style.opacity = '0.6';
                    submitBtn.style.cursor = 'not-allowed';
                } else {
                    submitBtn.style.opacity = '1';
                    submitBtn.style.cursor = 'pointer';
                }
            }

            passwordInput.addEventListener('input', checkPasswordMatch);
            confirmInput.addEventListener('input', checkPasswordMatch);

            form.addEventListener('submit', function(e) {
                const password = passwordInput.value;
                const confirm = confirmInput.value;
                
                if (password !== confirm) {
                    e.preventDefault();
                    alert('Passwords do not match. Please check and try again.');
                    return false;
                }
                
                if (password.length < 8) {
                    e.preventDefault();
                    alert('Password must be at least 8 characters long.');
                    return false;
                }
            });

            // Initial state
            checkPasswordMatch();
        </script>
    </body>
</html>